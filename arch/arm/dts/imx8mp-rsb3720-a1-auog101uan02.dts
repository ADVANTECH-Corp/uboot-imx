#include <dt-bindings/media/mipi_dsi.h>
#include "imx8mp-rsb3720-a1.dts"

/ {
	/delete-node/ rm67191_panel;

	reg_mipi_panel_vbus: reg-mipi-panel-vbus {
		compatible = "regulator-fixed";
		regulator-name = "mipi-panel";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		enable-active-high;
		gpio = <&gpio_exp2 7 GPIO_ACTIVE_HIGH>; /* LCD_BKLT1_EN */
	};

	lvds_backlight1: lvds_backlight@1 {
		compatible = "pwm-backlight";
		pwms = <&pwm3 0 5000000>;
		brightness-levels = < 0  1  2  3  4  5  6  7  8  9
				     10 11 12 13 14 15 16 17 18 19
				     20 21 22 23 24 25 26 27 28 29
				     30 31 32 33 34 35 36 37 38 39
				     40 41 42 43 44 45 46 47 48 49
				     50 51 52 53 54 55 56 57 58 59
				     60 61 62 63 64 65 66 67 68 69
				     70 71 72 73 74 75 76 77 78 79
				     80 81 82 83 84 85 86 87 88 89
				     90 91 92 93 94 95 96 97 98 99
				    100>;
		default-brightness-level = <80>;
	};
};

/delete-node/ &adv_bridge;

&i2c1 {
	gpio_exp2: tca9538@71 {
		compatible = "nxp,pca9538";
		reg = <0x71>;
		gpio-controller;
		#gpio-cells = <2>;
	};
};

&mipi_dsi {

	/delete-node/ port@1;
	/delete-node/ port@2;

	panel@0 {
		compatible = "simple-panel";
		reg = <0>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_lcd1>;
		enable-gpios = <&gpio1 13 GPIO_ACTIVE_LOW>;
		backlight = <&lvds_backlight1>;
		power-supply = <&reg_mipi_panel_vbus>;

		simple,dsi-flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_VIDEO_SYNC_PULSE | MIPI_DSI_MODE_EOT_PACKET)>;
		simple,dsi-format = <MIPI_DSI_FMT_RGB888>;
		simple,dsi-lanes = <4>;

		status = "okay";
		panel-init-sequence = [
			29 00 06 3C 01 03 00 02 00
			29 00 06 14 01 02 00 00 00
			29 00 06 64 01 00 00 00 00
			29 00 06 68 01 00 00 00 00
			29 00 06 6C 01 00 00 00 00
			29 00 06 70 01 00 00 00 00
			29 00 06 34 01 1F 00 00 00
			29 00 06 10 02 1F 00 00 00
			29 00 06 04 01 01 00 00 00
			29 00 06 04 02 01 00 00 00
			29 00 06 50 04 20 01 F0 03
			29 00 06 54 04 06 00 32 00
			29 00 06 58 04 20 03 C8 00
			29 00 06 5C 04 04 00 04 00
			29 00 06 60 04 E0 01 14 00
			29 00 06 64 04 01 00 00 00
			29 01 06 A0 04 2D 80 44 00
			29 00 06 A0 04 2D 80 04 00
			29 00 06 04 05 04 00 00 00
			29 00 06 80 04 00 01 02 03
			29 00 06 84 04 04 07 05 08
			29 00 06 88 04 09 0A 0E 0F
			29 00 06 8C 04 0B 0C 0D 10
			29 00 06 90 04 16 17 11 12
			29 00 06 94 04 13 14 15 1B
			29 14 06 98 04 18 19 1A 06
			29 78 06 9C 04 31 00 00 00
		];

		display-timings {
			native-mode = <&timing0>;
			timing0: timing0 {
				clock-frequency = <148500000>;
				hactive = <1920>;
				vactive = <1200>;
				hfront-porch = <60>;
				hback-porch = <60>;
				hsync-len = <18>;
				vback-porch = <4>;
				vfront-porch = <4>;
				vsync-len = <4>;
			};
		};

		port {
			panel1_in: endpoint {
				remote-endpoint = <&mipi_dsi_bridge_out>;
			};
		};
	};

	port@2 {
		mipi_dsi_bridge_out: endpoint {
			remote-endpoint = <&panel1_in>;
		};
	};
};

&iomuxc {
	pinctrl_pwm3: pwm3grp {
		fsl,pins = <
			MX8MP_IOMUXC_SAI5_RXC__PWM3_OUT		0x116	
		>;
	};

	pinctrl_bklt: bkltgrp {
		fsl,pins = <
			MX8MP_IOMUXC_GPIO1_IO01__GPIO1_IO01	0x19	/* VDD_BKLT1_EN */
		>;
	};

	pinctrl_lcd1: lcd1grp {
		fsl,pins = <
			MX8MP_IOMUXC_GPIO1_IO13__GPIO1_IO13	0x19	/* LCD1_VDD_EN */
		>;
	};
};

&pwm3 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm3>;
};

&lvds_backlight1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_bklt>;
	enable-gpios = <&gpio1 1 GPIO_ACTIVE_HIGH>; /* VDD_BKLT1_EN */
	status = "okay";
};
